<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Investigation Worklist</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
    />

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="./assets/kendo.metro.min.css" />
    <link rel="stylesheet" href="./assets/style.css" />
    <link rel="stylesheet" href="./assets/jquery-ui-1.9.1.custom.css" />
    <link rel="stylesheet" href="./assets/jquery.jscrollpane.css" />
    <link rel="stylesheet" href="./assets/kendo.common.min.css" />
    <link rel="stylesheet" href="./assets/nav.css" />
  </head>
  <body>
    <div id="navbar"></div>

    <div id="filterMenu" style="width: 100%">
      <div
        id="labMenuUpper"
        data-role="menu"
        class="k-widget k-reset k-header k-menu k-menu-horizontal"
        tabindex="0"
        role="menubar"
      >
        <div class="topnextprevcalender">
          <div class="reminderbtn">
            <div class="btnrmd">
              <input type="button" id="btnReminderTest" value="Reminder" />
            </div>
          </div>
          <div class="calendarara">
            <div
              style="
                display: flex;
                justify-content: center;
                align-items: center;
              "
              class="allbtn"
            >
              <i
                style="margin-left: 4px"
                class="fa-solid fa-share fa-flip-horizontal"
              ></i>
            </div>
            <div class="prev">
              <i id="prevDate" class="fa-solid fa-chevron-left"></i>
            </div>
            <h3>
              <input type="text" id="lbldate" readonly />
            </h3>
            <div>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">
                <path
                  d="M152 24c0-13.3-10.7-24-24-24s-24 10.7-24 24V64H64C28.7 64 0 92.7 0 128v16 48V448c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V192 144 128c0-35.3-28.7-64-64-64H344V24c0-13.3-10.7-24-24-24s-24 10.7-24 24V64H152V24zM48 192h80v56H48V192zm0 104h80v64H48V296zm128 0h96v64H176V296zm144 0h80v64H320V296zm80-48H320V192h80v56zm0 160v40c0 8.8-7.2 16-16 16H320V408h80zm-128 0v56H176V408h96zm-144 0v56H64c-8.8 0-16-7.2-16-16V408h80zM272 248H176V192h96v56z"
                />
              </svg>
              <div id="DateContainer" class="fromtodate" style="display: none">
                <span class="arw"></span>
                <h6>From Date</h6>
                <div class="inptarea">
                  <input
                    type="text"
                    id="txtFromDate"
                    class="k-input"
                    style="width: 100%"
                  />
                </div>
                <h6>To Date:</h6>
                <div class="inptarea no">
                  <input
                    type="text"
                    id="txtToDate"
                    class="k-input"
                    style="width: 100%"
                  />
                </div>
                <div style="width: 100%; text-align: center">
                  <a
                    href="javascript:void(0);"
                    id="btndateok"
                    style="
                      padding: 4px 10px;
                      background: #26a6dc;
                      border-radius: 3px;
                      color: #fff;
                      text-decoration: none;
                      text-transform: uppercase;
                      margin: 8px 0 5px;
                      display: inline-block;
                    "
                    >Ok</a
                  >
                </div>
              </div>
            </div>
            <div class="next">
              <i id="nextDate" class="fa-solid fa-chevron-right"></i>
              <input type="button" id="NextDate" value="Next" />
            </div>
            <div
              style="
                display: flex;
                justify-content: center;
                align-items: center;
              "
              class="reset"
              id="butReset"
            >
              <i class="fa-solid fa-rotate-right"></i>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const dateInput = document.getElementById("lbldate");
        let currentDate = new Date();

        // Initialize the date input field
        function updateDate() {
          dateInput.value = currentDate.toISOString().split("T")[0]; // Format as YYYY-MM-DD
        }

        // Event listener for the Previous button
        document
          .getElementById("prevDate")
          .addEventListener("click", function () {
            currentDate.setDate(currentDate.getDate() - 1); // Decrease the date by 1 day
            updateDate();
          });

        // Event listener for the Next button
        document
          .getElementById("nextDate")
          .addEventListener("click", function () {
            currentDate.setDate(currentDate.getDate() + 1); // Increase the date by 1 day
            updateDate();
          });

        // Initialize the date display
        updateDate();
      });
    </script>

    <div
      class="worklistlinks k-widget k-reset k-header k-menu k-menu-horizontal"
      id="labMenu"
      data-role="menu"
      tabindex="0"
      role="menubar"
    >
      <ul>
        <li class="branches">
          <a href="#">Branches</a>
          <div class="testdropdwn k-content" tabindex="-1">
            <div
              class="scroll-pane"
              style="overflow: hidden; padding: 0px; width: 140px"
            >
              <div class="jspContainer" style="width: 140px; height: 270px">
                <div
                  class="jspPane"
                  style="padding: 0px; top: 0px; width: 140px"
                >
                  <div id="selectBranches">
                    <!-- Branches will be dynamically inserted here -->
                  </div>
                </div>
              </div>
            </div>
          </div>
        </li>
        <li class="branches">
          <a href="#">Panel</a>
          <div class="testdropdwn k-content" tabindex="-1">
            <div
              class="scroll-pane"
              style="overflow: hidden; padding: 0px; width: 140px"
            >
              <div class="jspContainer" style="width: 140px; height: 270px">
                <div
                  class="jspPane"
                  style="padding: 0px; top: 0px; width: 140px"
                >
                  <div id="divPanel1"></div>
                </div>
              </div>
            </div>
          </div>
        </li>
        <li class="testic">
          <a href="javascript:void(0);">Test</a>
          <div class="testdropdwn k-content" style="width: 160px" tabindex="-1">
            <p>
              <input
                type="radio"
                name="testFilter"
                value="0"
                id="allTest"
                checked=""
              />
              <label for="allTest"> <span></span> All tests </label>
            </p>
            <p>
              <input
                type="radio"
                name="testFilter"
                value="5"
                id="pendingTest"
              />
              <label for="pendingTest" style="color: #cf8dea">
                <span></span> Pending Tests
              </label>
            </p>
            <p>
              <input
                type="radio"
                name="testFilter"
                value="1"
                id="partialTest"
              />
              <label for="partialTest" style="color: orange">
                <span></span> Partial Tests
              </label>
            </p>
            <p>
              <input
                type="radio"
                name="testFilter"
                value="2"
                id="completeTest"
              />
              <label for="completeTest" style="color: green">
                <span></span> Complete Tests
              </label>
            </p>
            <p>
              <input
                type="radio"
                name="testFilter"
                value="3"
                id="incompleteTest"
              />
              <label style="color: red" for="incompleteTest">
                <span></span> Incomplete Tests
              </label>
            </p>
            <p>
              <input
                type="radio"
                name="testFilter"
                value="4"
                id="outsourceTest"
              />
              <label style="color: gray" for="outsourceTest">
                <span></span> Outsource Tests
              </label>
            </p>
          </div>
        </li>
        <li class="sample">
          <a href="javascript:void(0);">Sample</a>
          <div class="testdropdwn k-content" tabindex="-1">
            <p>
              <input
                type="radio"
                name="sampleFilter"
                value="0"
                id="sampleFilAll"
                checked=""
              />
              <label for="sampleFilAll"> <span></span>All </label>
            </p>
            <p>
              <input
                type="radio"
                name="sampleFilter"
                id="sampleFilYes"
                value="1"
              />
              <label for="sampleFilYes"> <span></span>Yes </label>
            </p>
            <p>
              <input
                type="radio"
                name="sampleFilter"
                id="sampleFilNo"
                value="2"
              />
              <label for="sampleFilNo"> <span></span>No </label>
            </p>
          </div>
        </li>
        <li class="due">
          <a href="javascript:void(0);">Due</a>
          <div class="testdropdwn k-content" tabindex="-1">
            <p>
              <input
                type="radio"
                name="paidFilter"
                id="paidFil"
                value="0"
                checked=""
              />
              <label for="paidFil"> <span></span> All </label>
            </p>
            <p>
              <input type="radio" name="paidFilter" id="paidFilt" value="1" />
              <label style="color: orange" for="paidFilt">
                <span></span> Fully Paid
              </label>
            </p>
            <p>
              <input type="radio" name="paidFilter" id="paidFilD" value="2" />
              <label style="color: green" for="paidFilD">
                <span></span> Due
              </label>
            </p>
            <p>
              <input type="radio" name="paidFilter" id="paidFilR" value="3" />
              <label style="color: red" for="paidFilR">
                <span></span>Refund
              </label>
            </p>
          </div>
        </li>
        <li class="delivery">
          <a href="javascript:void(0);"> Delivery</a>
          <div class="testdropdwn k-content" tabindex="-1">
            <p>
              <input
                type="radio"
                name="deliverFilter"
                id="deliverFA"
                value="0"
                checked=""
              />
              <label for="deliverFA"> <span></span> All </label>
            </p>
            <p>
              <input
                type="radio"
                name="deliverFilter"
                id="deliverFDB"
                value="1"
              />
              <label for="deliverFDB"> <span></span>Delivery Boy </label>
            </p>
            <p>
              <input
                type="radio"
                name="deliverFilter"
                id="deliverFE"
                value="2"
              />
              <label for="deliverFE"> <span></span>Email </label>
            </p>
            <p>
              <input
                type="radio"
                name="deliverFilter"
                id="deliverFilH"
                value="3"
              />
              <label for="deliverFilH"> <span></span>Hospital </label>
            </p>
            <p>
              <input
                type="radio"
                name="deliverFilter"
                id="deliverFilC"
                value="4"
              />
              <label for="deliverFilC"> <span></span>Courier </label>
            </p>
            <p>
              <input
                type="radio"
                name="deliverFilter"
                id="deliverFilS"
                value="5"
              />
              <label for="deliverFilS"> <span></span>Self </label>
            </p>
          </div>
        </li>
        <li class="chek">
          <a href="javascript:void(0);">Checked</a>
          <div class="testdropdwn k-content" tabindex="-1">
            <p>
              <input
                type="radio"
                name="checkedFilter"
                value="0"
                id="AllChecked"
                checked=""
              />
              <label for="AllChecked"> <span></span> All </label>
            </p>
            <p>
              <input
                type="radio"
                name="checkedFilter"
                value="1"
                id="YesChecked"
              />
              <label for="YesChecked"> <span></span>Yes </label>
            </p>
            <p>
              <input
                type="radio"
                name="checkedFilter"
                value="2"
                id="NoChecked"
              />
              <label for="NoChecked"> <span></span>No </label>
            </p>
          </div>
        </li>
        <li class="printed">
          <a href="javascript:void(0);">Published</a>
          <div class="testdropdwn k-content" tabindex="-1">
            <p>
              <input
                type="radio"
                name="publishedFilter"
                value="0"
                id="AllPublished"
                checked=""
              />
              <label for="AllPublished"> <span></span> All </label>
            </p>
            <p>
              <input
                type="radio"
                name="publishedFilter"
                value="1"
                id="YesPublished"
              />
              <label for="YesPublished"> <span></span>Yes </label>
            </p>
            <p>
              <input
                type="radio"
                name="publishedFilter"
                value="2"
                id="NoPublished"
              />
              <label for="NoPublished"> <span></span>No </label>
            </p>
          </div>
        </li>

        <li class="delivered">
          <a href="javascript:void(0);">Delivered</a>
          <div class="testdropdwn k-content" tabindex="-1">
            <p>
              <input
                type="radio"
                name="deliveredFilter"
                value="0"
                id="AllDelivered"
                checked=""
              />
              <label for="AllDelivered"> <span></span>All </label>
            </p>
            <p>
              <input
                type="radio"
                name="deliveredFilter"
                value="1"
                id="YesDelivered"
              />
              <label for="YesDelivered"> <span></span>Yes </label>
            </p>
            <p>
              <input
                type="radio"
                name="deliveredFilter"
                value="2"
                id="NoDelivered"
              />
              <label for="NoDelivered"> <span></span>No </label>
            </p>
          </div>
        </li>
        <li class="canceled">
          <a href="javascript:void(0);">Cancelled</a>
          <div class="testdropdwn k-content" tabindex="-1">
            <p>
              <input
                type="radio"
                name="cancelFilter"
                id="cancleAll"
                value="0"
                checked=""
              />
              <label for="cancleAll"> <span></span>All </label>
            </p>
            <p>
              <input
                type="radio"
                name="cancelFilter"
                id="cancleYes"
                value="1"
              />
              <label for="cancleYes"> <span></span>Yes </label>
            </p>
            <p>
              <input type="radio" name="cancelFilter" id="cancleNo" value="2" />
              <label for="cancleNo"> <span></span>No </label>
            </p>
          </div>
        </li>
        <li class="due">
          <a href="javascript:void(0);">Pay Mode</a>
          <div class="testdropdwn k-content" tabindex="-1">
            <p>
              <input
                type="radio"
                name="payFilter"
                id="payAll"
                value="0"
                checked=""
              />
              <label for="payAll"> <span></span>All </label>
            </p>
            <p>
              <input type="radio" name="payFilter" id="payCash" value="1" />
              <label for="payCash"> <span></span>Cash </label>
            </p>
            <p>
              <input type="radio" name="payFilter" id="payCheque" value="2" />
              <label for="payCheque"> <span></span>Cheque </label>
            </p>
            <p>
              <input type="radio" name="payFilter" id="payCard" value="3" />
              <label for="payCard"> <span></span>Card </label>
            </p>
          </div>
        </li>
        <li class="urgent">
          <a href="javascript:void(0);">Urgent Tests</a>
          <input type="checkbox" id="isUrgent" />
          <label style="color: red" for="isUrgent">
            <span></span>
          </label>
        </li>
      </ul>
    </div>

    <div>
      <div class="grdhdng">
        <h2>Investigation Worklist</h2>
        <input type="text" id="txtBarCode" placeholder="Barcode Search" />
        <input type="text" id="txtSearchWorkList" placeholder="Search" />
      </div>

      <div
        id="grid"
        oncontextmenu="return false;"
        data-role="grid"
        class="k-grid k-widget"
        style="height: 430px"
      >
        <div class="k-grid-header" style="padding-right: 0px">
          <div class="k-grid-header-wrap" data-role="resizable">
            <table role="grid" tabindex="-1">
              <colgroup>
                <col class="k-hierarchy-col" />
                <col style="width: 80px" />
                <col style="width: 180px" />
                <col style="width: 145px" />
                <col style="width: 110px" />
                <col style="width: 35px" />
                <col style="width: 60px" />
                <col style="width: 60px" />
                <col style="width: 60px" />
                <col style="width: 60px" />
                <col style="width: 60px" />
                <col style="width: 60px" />
                <col style="width: 60px" />
              </colgroup>
              <thead></thead>
            </table>
          </div>
        </div>
        <div class="k-grid-content scroll-pane" style="height: 418.8px">
          <!-- <table
            role="treegrid"
            tabindex="0"
            data-role="selectable"
            class="k-selectable"
            style="height: auto"
          >
            <colgroup>
              <col class="k-hierarchy-col" />
              <col style="width: 80px" />
              <col style="width: 180px" />
              <col style="width: 145px" />
              <col style="width: 110px" />
              <col style="width: 35px" />
              <col style="width: 60px" />
              <col style="width: 60px" />
              <col style="width: 60px" />
              <col style="width: 60px" />
              <col style="width: 60px" />
              <col style="width: 60px" />
              <col style="width: 60px" />
            </colgroup>
            
          </table> -->
          <table
            role="treegrid"
            tabindex="0"
            data-role="selectable"
            class="k-selectable"
            style="height: auto;padding: 15px;"
          >
            <colgroup>
              <col style="width: 90px" />
              <col style="width: 160px" />
              <col style="width: 150px" />
              <col style="width: 155px" />
              <col style="width: 160px" />
              <col style="width: 150px" />
            </colgroup>
            <thead style="padding: 15px;">
              <tr>
                <th>Serial No.</th>
                <th>PID</th>
                <th>Patient Name</th>
                <th>Advised Date</th>
                <!-- <th>Selected Tests</th> -->
                <th>Advised By Doctor</th>
                <th>Advised By Facility</th>
                <th>Ref</th>
                <th>Total</th>
                <th>Dis</th>
                <th>Tax</th>
                <th>Net</th>
                <th>Bal</th>
              </tr>
            </thead>
            <tbody id="patientsTableBody">
              <!-- Patient rows will be dynamically inserted here -->
            </tbody>
          </table>
        </div>

        <div class="k-grid-footer" tabindex="-1" style="padding-right: 0px">
          <div class="k-grid-footer-wrap">
            <table>
              <colgroup>
                <col class="k-hierarchy-col" />
                <col style="width: 80px" />
                <col style="width: 180px" />
                <col style="width: 145px" />
                <col style="width: 110px" />
                <col style="width: 35px" />
                <col style="width: 60px" />
                <col style="width: 60px" />
                <col style="width: 60px" />
                <col style="width: 60px" />
                <col style="width: 60px" />
                <col style="width: 60px" />
                <col style="width: 60px" />
              </colgroup>
              <tbody>
                <tr class="k-footer-template">
                  <td class="k-hierarchy-cell">&nbsp;</td>
                  <td>&nbsp;</td>
                  <td>&nbsp;</td>
                  <td>&nbsp;</td>
                  <td>&nbsp;</td>
                  <td>20</td>
                  <td>5630.00</td>
                  <td>0.00</td>
                  <td>0.00</td>
                  <td>5630.00</td>
                  <td>0.00</td>
                  <td>5630.00</td>
                  <td>0.00</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
        <div class="k-pager-wrap k-grid-pager k-widget" data-role="pager">
          <a
            href="#"
            title="Go to the first page"
            class="k-link k-state-disabled"
            data-page="1"
            tabindex="-1"
            ><span class="k-icon k-i-seek-w">Go to the first page</span></a
          ><a
            href="#"
            title="Go to the previous page"
            class="k-link k-state-disabled"
            data-page="1"
            tabindex="-1"
            ><span class="k-icon k-i-arrow-w">Go to the previous page</span></a
          >
          <ul class="k-pager-numbers k-reset">
            <li><span class="k-state-selected">1</span></li>
            <li>
              <a tabindex="-1" href="#" class="k-link" data-page="2">2</a>
            </li>
          </ul>
          <a
            href="#"
            title="Go to the next page"
            class="k-link"
            data-page="2"
            tabindex="-1"
            ><span class="k-icon k-i-arrow-e">Go to the next page</span></a
          ><a
            href="#"
            title="Go to the last page"
            class="k-link"
            data-page="2"
            tabindex="-1"
            ><span class="k-icon k-i-seek-e">Go to the last page</span></a
          ><span class="k-pager-info k-label">1 - 20 of 28 items</span>
        </div>
      </div>
    </div>

    <script src="./nav.js"></script>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script>
      $(document).ready(function () {
        // Get username from local storage
        var username = localStorage.getItem("username");

        // Check if username exists in local storage
        if (!username) {
          console.error("No username found in local storage.");
          return;
        }

        // Fetch branches based on username
        $.ajax({
          url: "https://rssmarthut.com/mypath/fetchBranches.php",
          type: "GET",
          data: { username: encodeURIComponent(username) },
          dataType: "json",
          success: function (data) {
            if (data.error) {
              console.error(data.error);
              return;
            }

            var branchDropdown = $("#selectBranches");
            branchDropdown.empty(); // Clear existing entries

            if (data.length === 0) {
              branchDropdown.append("<p>No branches found.</p>");
              return;
            }

            // Populate dropdown with branch names
            $.each(data, function (index, branch) {
              branchDropdown.append(
                '<p><input type="checkbox" class="branch-checkbox" data-branch-id="' +
                  branch.branchid +
                  '" id="chkLocation' +
                  index +
                  '"/><label for="chkLocation' +
                  index +
                  '"><span></span>' +
                  branch.branchname +
                  "</label></p>"
              );
            });

            branchDropdown.show(); // Show the dropdown if it was hidden
          },
          error: function (xhr, status, error) {
            console.error("AJAX Error: " + status + " - " + error);
          },
        });

        // Event delegation to handle clicks on dynamically added checkboxes
        $("#selectBranches").on("change", ".branch-checkbox", function () {
          // Get the ID of the selected branch
          var selectedBranchId = $(this).data("branch-id");

          // Get the branch name associated with the selected ID
          var selectedBranchName = $(this).next("label").text();

          // Update the "Branches" label with the selected branch name
          if ($(this).is(":checked")) {
            $(".branches > a").text(selectedBranchName);
          } else {
            // If no branch is selected, reset the label
            $(".branches > a").text("Branches");
          }
          const date = document.getElementById("lbldate").value;
          console.log(date)
          fetchPatients(selectedBranchName,date);
          // Handle the selected branch ID and perform additional actions if needed
        });
      });
    </script>

    <script>
      function fetchPatients(branchname, date) {
        $.ajax({
          url: "https://rssmarthut.com/mypath/worklist.php",
          type: "GET",
          data: { branchname: branchname, date: date },
          dataType: "json",
          success: function (data) {
            if (data.error) {
              console.error(data.error);
              return;
            }

            // Get the table body element
            const tableBody = document.getElementById("patientsTableBody");
            tableBody.innerHTML = ""; // Clear existing rows

            // Populate the table with patient data
            data.forEach((patient) => {
              const row = document.createElement("tr");

              // Create cells for each column and append to the row
              const idCell = document.createElement("td");
              idCell.textContent = patient.id;
              row.appendChild(idCell);

              const pidCell = document.createElement("td");
              pidCell.textContent = patient.pid;
              row.appendChild(pidCell);

              const nameCell = document.createElement("td");
              nameCell.textContent = patient.patientname;
              row.appendChild(nameCell);
              const dateCell = document.createElement("td");
              dateCell.textContent = patient.advisedDate.split(' ')[0];
              row.appendChild(dateCell);

              
              const doctorCell = document.createElement("td");
              doctorCell.textContent = patient.advisedByDoctor;
              row.appendChild(doctorCell);
              const facilityCell = document.createElement("td");
              facilityCell.textContent = patient.advisedByFacility;
              row.appendChild(facilityCell);
              const referredCell = document.createElement("td");
              referredCell.textContent = patient.referredBy;
              row.appendChild(referredCell);
              const testsCell = document.createElement("td");
              const selectedTestsArray = JSON.parse(patient.selectedTests);
              const totalPrice = selectedTestsArray.reduce((sum, test) => sum + parseFloat(test.price), 0);
              testsCell.textContent =  totalPrice.toFixed(2);
              row.appendChild(testsCell);
              const disCell = document.createElement("td");
              disCell.textContent = 0;
              row.appendChild(disCell);
              const taxCell = document.createElement("td");
              taxCell.textContent = 0;
              row.appendChild(taxCell);
              const netCell = document.createElement("td");
              netCell.textContent = JSON.parse(patient.selectedTests).reduce((sum, test) => sum + parseFloat(test.price), 0).toFixed(2);
              row.appendChild(netCell);
              const balCell = document.createElement("td");
              balCell.textContent = JSON.parse(patient.selectedTests).reduce((sum, test) => sum + parseFloat(test.price), 0).toFixed(2);
              row.appendChild(balCell);

              // Append the row to the table body
              tableBody.appendChild(row);
            });
          },
          error: function (xhr, status, error) {
            console.error("AJAX Error: " + status + " - " + error);
          },
        });
      }

  
    </script>
  </body>
</html>
